<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cinematic Voice Tool ‚Äì Pixabay API</title>

<style>
body{margin:0;padding:0;font-family:'Segoe UI',sans-serif;background:#f2f2f2;}
.voice-visual-tool{max-width:1280px;margin:auto;background:#fff;padding:20px;border-radius:16px;box-shadow:0 0 20px rgba(0,0,0,.15);}
textarea{width:100%;height:180px;font-size:16px;padding:10px;border-radius:8px;border:1px solid #ccc;resize:none;}
button,select{padding:12px 22px;font-size:16px;background:#ff4d4f;color:#fff;border:none;border-radius:6px;cursor:pointer;margin:6px 6px 6px 0;}

.voice-visual-preview{
  margin-top:20px;
  aspect-ratio:16/9;
  position:relative;
  overflow:hidden;
  border-radius:20px;
  background:#000;
  color:#fff;
}

.visual-preview{
  position:absolute;
  inset:0;
  z-index:1;
}
.visual-preview img,
.visual-preview video{
  width:100%;
  height:100%;
  object-fit:cover;
  display:none;
}

.text-container{
  position:relative;
  z-index:2;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:20px;
  font-size:2.5vw;
  font-weight:700;
  text-shadow:2px 2px 10px #000;
}

.voice-caption-container{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;}
.voice-caption-word{opacity:0;animation:fadeIn .5s forwards;}
.voice-caption-word.big{font-size:1.5em;color:#ffeb3b;}
.voice-caption-word.emoji{font-size:2.5em;}

.scroll-caption-strip{
  position:absolute;bottom:0;left:0;right:0;
  background:linear-gradient(90deg,#ff4d4f,#ffd700);
  color:#000;font-weight:700;
  height:2.5em;line-height:2.5em;
  white-space:nowrap;overflow:hidden;
  z-index:3;
}
.scroll-caption-strip span{
  display:inline-block;padding-left:100%;
  animation:scroll 18s linear infinite;
}

@keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}
@keyframes fadeIn{from{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}

@media(max-width:768px){
  .text-container{font-size:4vw;}
}
</style>
</head>

<body>
<div class="voice-visual-tool">
<h2>üé¨ Cinematic Voice Tool (Auto Video/Image)</h2>

<textarea id="scriptInput" placeholder="Script yahan paste karo..."></textarea><br>

<select id="voiceLang">
  <option value="hi-IN">Hindi</option>
  <option value="en-US">English</option>
</select>

<select id="voiceSpeed">
  <option value="0.8">Slow</option>
  <option value="1" selected>Normal</option>
  <option value="1.2">Fast</option>
</select>

<select id="videoLength">
  <option value="short">Short</option>
  <option value="long" selected>Long</option>
</select>

<button onclick="startPlayback()">‚ñ∂Ô∏è Play</button>

<div class="voice-visual-preview">
  <div class="visual-preview">
    <img id="visualImg">
    <video id="visualVideo" autoplay muted loop playsinline></video>
  </div>

  <div class="text-container" id="textOutput"></div>

  <div class="scroll-caption-strip">
    <span>LIKE ‚Ä¢ SHARE ‚Ä¢ SUBSCRIBE ‚Ä¢ LIKE ‚Ä¢ SHARE ‚Ä¢ SUBSCRIBE</span>
  </div>
</div>
</div>

<script>
/* ================== PIXABAY API ================== */
const PIXABAY_KEY="54255969-e91e54d4235ef4c9b25009a63";

/* ================== GLOBALS ================== */
let chunks=[],currentIndex=0,wakeLock=null;

/* ================== WAKE LOCK ================== */
async function requestWakeLock(){
  try{ if("wakeLock" in navigator) wakeLock=await navigator.wakeLock.request("screen"); }
  catch(e){console.log(e);}
}

/* ================== HELPERS ================== */
function splitScript(t){return t.split(/\n+/).map(l=>l.trim()).filter(Boolean);}
function cleanForVoice(t){
  return t
   .replace(/[\u{1F300}-\u{1FAFF}\u{1F600}-\u{1F64F}]/gu,"")
   .replace(/GIF suggestion:.*/gi,"");
}

function extractKeyword(t){
  const stop=["‡§π‡•à","‡§•‡§æ","‡§•‡•á","‡§ï‡•Ä","‡§ï‡§æ","‡§ï‡•á","‡§Æ‡•á‡§Ç","‡§î‡§∞","‡§è‡§ï","‡§∏‡•á","for","the","is"];
  let w=t.replace(/[^\p{L}\s]/gu,"").split(/\s+/)
        .filter(x=>x.length>2 && !stop.includes(x.toLowerCase()));
  return w[0]||"nature";
}

/* ================== PIXABAY FETCH ================== */
async function fetchVisual(keyword){
  try{
    let v=await fetch(`https://pixabay.com/api/videos/?key=${PIXABAY_KEY}&q=${encodeURIComponent(keyword)}&per_page=3&safesearch=true`);
    let vd=await v.json();
    if(vd.hits?.length) return {type:"video",url:vd.hits[0].videos.medium.url};

    let i=await fetch(`https://pixabay.com/api/?key=${PIXABAY_KEY}&q=${encodeURIComponent(keyword)}&image_type=photo&safesearch=true`);
    let id=await i.json();
    if(id.hits?.length) return {type:"image",url:id.hits[0].webformatURL};
  }catch(e){console.log(e);}
  return {type:"image",url:"https://picsum.photos/1280/720"};
}

/* ================== PLAY ================== */
function startPlayback(){
  let script=document.getElementById("scriptInput").value;
  let len=document.getElementById("videoLength").value;

  chunks=splitScript(script).map(t=>({
    original:t,
    voice:cleanForVoice(t),
    key:extractKeyword(t)
  }));

  if(len==="short") chunks=chunks.slice(0,5);
  currentIndex=0;
  requestWakeLock();
  playNext();
}

async function playNext(){
  if(currentIndex>=chunks.length){
    if(wakeLock) wakeLock.release();
    return;
  }

  const {original,voice,key}=chunks[currentIndex];
  document.getElementById("textOutput").innerHTML=wrapText(original);

  const visual=await fetchVisual(key);
  const img=document.getElementById("visualImg");
  const vid=document.getElementById("visualVideo");

  if(visual.type==="video"){
    vid.src=visual.url;vid.style.display="block";img.style.display="none";
  }else{
    img.src=visual.url;img.style.display="block";vid.style.display="none";
  }

  let u=new SpeechSynthesisUtterance(voice);
  u.lang=document.getElementById("voiceLang").value;
  u.rate=parseFloat(document.getElementById("voiceSpeed").value);
  u.onend=()=>{currentIndex++;playNext();};
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* ================== TEXT STYLE ================== */
function wrapText(t){
  const hot=["‚Çπ","$","FREE","SCAM","ALERT","NOW"];
  return '<div class="voice-caption-container">'+
  t.split(/\s+/).map((w,i)=>{
    let c="";
    if(/^[\u{1F300}-\u{1FAFF}\u{1F600}-\u{1F64F}]/u.test(w)) c="emoji";
    else if(hot.some(h=>w.toUpperCase().includes(h))) c="big";
    return `<span class="voice-caption-word ${c}" style="animation-delay:${i*.12}s">${w}</span>`;
  }).join(" ")+'</div>';
}
</script>
</body>
</html>
