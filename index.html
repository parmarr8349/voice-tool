<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Final Cinematic Wake-Lock Voice Tool</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: transparent;
    }

    .voice-visual-tool {
      max-width: 1280px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 0 15px rgba(0,0,0,.1);
    }

    textarea {
      width: 100%;
      height: 180px;
      font-size: 16px;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: none;
    }

    button, select {
      padding: 12px 24px;
      font-size: 16px;
      background: #ff4d4f;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 5px;
    }

    .voice-visual-preview {
      margin-top: 30px;
      aspect-ratio: 16 / 9;
      width: 100%;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5vw;
      font-weight: 700;
      border-radius: 20px;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      padding: 2vw;
      text-shadow: 2px 2px 8px #000;
      color: #fff;
      position: relative;
    }

    .avatar-container {
      width: 160px;
      visibility: hidden;
    }

    .avatar-container img {
      width: 100%;
    }

    .text-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      z-index: 2;
      text-align: center;
    }

    .voice-caption-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .voice-caption-word {
      opacity: 0;
      animation: fadeIn .5s forwards;
    }

    .voice-caption-word.big {
      font-size: 1.5em;
      color: #ffeb3b;
    }

    .scroll-caption-strip {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: red;
      color: black;
      font-size: 2vw;
      white-space: nowrap;
      overflow: hidden;
      height: 2.8em;
      line-height: 2.8em;
      z-index: 3;
    }

    .scroll-caption-strip span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-strip 20s linear infinite;
    }

    @keyframes scroll-strip {
      from { transform: translateX(0); }
      to { transform: translateX(-100%); }
    }

    @keyframes fadeIn {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>

<body>

<div class="voice-visual-tool">
  <h2>üéôÔ∏è Final Cinematic Wake-Lock Voice Tool</h2>

  <textarea id="scriptInput" placeholder="Paste your full script here..."></textarea>

  <select id="voiceLang">
    <option value="en-US">English</option>
    <option value="hi-IN">Hindi</option>
  </select>

  <select id="voiceSpeed">
    <option value="0.8">Slow</option>
    <option value="1" selected>Normal</option>
    <option value="1.2">Fast</option>
    <option value="1.5">Faster</option>
  </select>

  <br><br>

  <button onclick="startPlayback()">‚ñ∂Ô∏è Play</button>
  <button onclick="startRecording()">‚¨áÔ∏è Auto Download Video</button>

  <div class="voice-visual-preview" id="preview">
    <div class="avatar-container">
      <img src="https://i.ibb.co/cSMndFgK/1000000918-unscreen.gif">
    </div>
    <div class="text-container" id="textOutput"></div>
    <div class="scroll-caption-strip">
      <span>LIKE ‚Ä¢ SHARE ‚Ä¢ SUBSCRIBE</span>
    </div>
  </div>

  <audio id="typeSound" src="https://files.catbox.moe/8yzjgp.mp3"></audio>
  <audio id="bgMusic" loop src="https://files.catbox.moe/f8xqq8.mp3"></audio>
</div>

<script>
/* ===== ORIGINAL LOGIC (UNCHANGED) ===== */

let chunks=[],currentIndex=0,speed=1,lang='en-US',wakeLock=null;
function splitScript(s){return s.split(/\n+/).map(l=>l.trim()).filter(l=>l);}
function requestWakeLock(){ if('wakeLock'in navigator){navigator.wakeLock.request('screen');}}

function startPlayback(){
  const script=document.getElementById("scriptInput").value;
  speed=parseFloat(voiceSpeed.value);
  lang=voiceLang.value;

  bgMusic.volume=.2;
  bgMusic.play().catch(()=>{});

  chunks=splitScript(script).map(t=>({o:t,s:t}));
  currentIndex=0;
  requestWakeLock();
  playNext();
}

function playNext(){
  if(currentIndex>=chunks.length){
    bgMusic.pause();
    return;
  }

  textOutput.innerHTML=chunks[currentIndex].o.split(" ").map(
    (w,i)=>`<span class="voice-caption-word" style="animation-delay:${i*.15}s">${w}</span>`
  ).join(" ");

  const u=new SpeechSynthesisUtterance(chunks[currentIndex].s);
  u.lang=lang;
  u.rate=speed;
  u.onend=()=>{currentIndex++;playNext();}
  speechSynthesis.speak(u);
}

/* ===== D9 : AUTO RECORD + AUTO DOWNLOAD (ADDITION) ===== */

let recorder,recorded=[];

async function startRecording(){
  const stream=preview.captureStream(30);
  recorder=new MediaRecorder(stream,{mimeType:"video/webm"});
  recorded=[];
  recorder.ondataavailable=e=>e.data.size&&recorded.push(e.data);
  recorder.onstop=downloadVideo;
  recorder.start();
  startPlayback();
}

function downloadVideo(){
  const blob=new Blob(recorded,{type:"video/webm"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="cinematic-video.webm";
  a.click();
  URL.revokeObjectURL(url);
}
</script>

</body>
  </html>
